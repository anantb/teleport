<!-- 
@author: Anant Bhardwaj

Teleport Web Page
-->
<!DOCTYPE html> 
<html> 
<head> 
	<title>Teleport</title> 
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/teleport.css" />
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <link rel=stylesheet href='css/firstpersoncam.css' type='text/css' />
    <!-- *** Replace the key below below with your own API key, available at http://code.google.com/apis/maps/signup.html *** -->
    <script src="http://www.google.com/jsapi?key=AIzaSyAdgYw9dd2TiekDSJ7tsQC0ogDcDwD673s"></script>
    <script type="text/javascript" src="lib/keyboard-focus-hack.js"></script>
    <script type="text/javascript" src="lib/math3d.js"></script>
    <script type="text/javascript" src="javascript/firstpersoncam.js"></script>
    <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>
</head>
<body>

<script type="text/javascript">
$(document).bind("mobileinit", function(){
   $.mobile.defaultTransition = 'none'
});


console.log('teleportme')
google.load("earth", "1");
google.load("maps", "2");

var ge = null;
var cam;

function init() {
    init3D();
}

function initCB(object) {
    ge = object;
    ge.getOptions().setFlyToSpeed(100);

    //ge.getLayerRoot().enableLayerById(ge.LAYER_ROADS, true);
    ge.getLayerRoot().enableLayerById(ge.LAYER_BUILDINGS, true);
    // ge.getLayerRoot().enableLayerById(ge.LAYER_TERRAIN, true);
    //ge.getLayerRoot().enableLayerById(ge.LAYER_TREES, true);

    cam = new FirstPersonCam();
    cam.refreshCamera();
    ge.getWindow().setVisibility(true);

    keyboardFocusHack(ge);
}

function failureCB(object) {
    alert("somthing went wrong!")
}

function init3D() {
    google.earth.createInstance("map3d", initCB, failureCB);
} 





$("#teleportme").live('pageinit', function (e) {       
    
    $('#map-container').keyup(function(event) {
        console.log(event)
        return keyUp(event);
      
    });

     $('#map-container').keydown(function(event) {
        console.log(event)
        return keyDown(event);
      
    });
    init()

});


$("#chat").live('pageinit', function(e){
    // Initialize API key, session, and token...
    // Think of a session as a room, and a token as the key to get in to the room
    // Sessions and tokens are generated on your server and passed down to the client
    var apiKey = "1127";
    var sessionId = "1_MX4xMTI3fn5XZWQgQXByIDE3IDE5OjU0OjIzIFBEVCAyMDEzfjAuNDAwOTQ1OX4";
    var token = "T1==cGFydG5lcl9pZD0xMTI3JnNpZz1lZDM3N2JjODlhNmViZDNiMDJjZDg3MzE0OGQ2NWE4NTRhZTFiYjdlOnNlc3Npb25faWQ9MV9NWDR4TVRJM2ZuNVhaV1FnUVhCeUlERTNJREU1T2pVME9qSXpJRkJFVkNBeU1ERXpmakF1TkRBd09UUTFPWDQmY3JlYXRlX3RpbWU9MTM2NjI1MzY2MyZub25jZT05NTAzNjMmcm9sZT1wdWJsaXNoZXI=";

    // Enable console logs for debugging
    TB.setLogLevel(TB.DEBUG);

    // Initialize session, set up event listeners, and connect
    var session = TB.initSession(sessionId);
    session.addEventListener('sessionConnected', sessionConnectedHandler);
    session.addEventListener('streamCreated', streamCreatedHandler);
    session.connect(apiKey, token);
    function sessionConnectedHandler(event) {
        var publisher = TB.initPublisher(apiKey, 'my-chat-window');
        session.publish(publisher);

        // Subscribe to streams that were in the session when we connected
        subscribeToStreams(event.streams);
    }

    function streamCreatedHandler(event) {
        // Subscribe to any new streams that are created
        subscribeToStreams(event.streams);
    }

    function subscribeToStreams(streams) {
        for (var i = 0; i < streams.length; i++) {
        // Make sure we don't subscribe to ourself
            if (streams[i].connection.connectionId == session.connection.connectionId) {
              return;
            }

            // Create the div to put the subscriber element in to
            var div = $('<div></div>');
            div.attr('id', 'stream' + streams[i].streamId);
            //document.body.appendChild(div);
            div.appendTo($('chat-windows'))
            // Subscribe to the stream
            session.subscribe(streams[i], div.attr('id'));
        }
    }


});



</script>



<div data-role="page" id="home" class="teleport">
    <div data-role="header">
        <h1>Teleport</h1>
        <a href="#settings" data-icon="gear" class="ui-btn-right">Settings</a>
	    <div data-role="navbar">
	            <ul>
	                <li><a href="#home" data-icon="home" class="ui-btn-active ui-state-persist">Home</a></li>
	                <li><a href="#contacts" data-icon="grid">Contacts</a></li>
	                <li><a href="#recents" data-icon="bars">Recents</a></li>
                    <li><a href="#teleportme" data-icon="arrow-r">Teleport Me</a></li>
	            </ul>
	    </div><!-- /navbar -->
    
    </div><!-- /header -->
    <div data-role="content">
        
        <div data-role="collapsible" data-collapsed="false" data-theme="b" data-content-theme="d">
            <h4>Recent Contacts</h4>
            <ul data-role="listview" data-theme="d">
                <li><a href="#">Anant Bhardwaj</a></li>
                <li><a href="#">Alex Pagan</a></li>
                <li><a href="#">Ekaterina Ob'yedkova</a></li>
                <li><a href="#">Sarah Lehmann</a></li>
            </ul>
        </div>
        <br />
        <div data-role="collapsible" data-collapsed="false" data-theme="b" data-content-theme="d">
            <h4>New Notifications</h4>
            <ul data-role="listview" data-theme="d">
                <li><a href="index.html">
                    <p><strong>Alex Pagan wants to add you to his contact list.</strong></p>
                    <p>Hey Anant, This is Alex Pagan!.</p>  
                    <span class="ui-li-count">April 17, 2013 05:49 PM</span>                     
                </a></li>
                <li><a href="index.html">
                    <p><strong>Ekaterina Ob'yedkova has new tweets.</strong></p>
                    <p>The trip to New York was amazing...</p>
                    <span class="ui-li-count">April 17, 2013 11:04 AM</span>   
                </a></li>
                <li><a href="index.html">
                    <p><strong>Raj Aryan accepted your friend request.</strong></p>
                    <span class="ui-li-count">April 16, 2013 06:09 PM</span>   
                </a></li>
            </ul>
        </div>
    </div>
	
</div><!-- /home -->


<div data-role="page" data-theme="b" id="contacts" class="teleport grid">
    <div data-role="header">
        <h1>Teleport</h1>
        <a href="#settings" data-icon="gear" class="ui-btn-right">Settings</a>
	    <div data-role="navbar">
	            <ul>
	                <li><a href="#home" data-icon="home">Home</a></li>
	                <li><a href="#contacts" data-icon="grid" class="ui-btn-active ui-state-persist">Contacts</a></li>
	                <li><a href="#recents" data-icon="bars">Recents</a></li>
                    <li><a href="#teleportme" data-icon="arrow-r">Teleport Me</a></li>
	            </ul>
	    </div><!-- /navbar -->
        
    </div><!-- /header -->
    <div data-role="content">
        <ul data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="Search contacts">
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>Anant Bhardwaj</h2>
                <p>MIT</p>
                <p class="ui-li-aside">Online</p>
            </a></li>
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>Alex Pagan</h2>
                <p>MIT</p>
                <p class="ui-li-aside">Online</p>
            </a></li>
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>Ekaterina Ob'yedkova</h2>
                <p>MIT</p>
                <p class="ui-li-aside">Online</p>
            </a></li>
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>Rob Miller</h2>
                <p>MIT Professor</p>
                <p class="ui-li-aside">Online</p>
            </a></li>
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>Sarah Lehmann</h2>
                <p>Amazing TA</p>
                <p class="ui-li-aside">Online</p>
            </a></li>            
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>Raj Aryan</h2>
                <p>San Francisco</p>
                <p class="ui-li-aside">Away</p>
            </a></li>
            <li><a href="#chat">
                <img src="images/profile.png">
                <h2>David Cheriton</h2>
                <p>Stanford</p>
                <p class="ui-li-aside">Away</p>
            </a></li>
            <li><a href="#chat">
				<img src="images/profile.png">
                <h2>Sam Madden</h2>
                <p>MIT</p>
                <p class="ui-li-aside">Away</p>
            </a></li>
        </ul>
    </div><!-- /contacts -->   
</div>



<div data-role="page" id="recents" class="teleport">
    <div data-role="header">
        <h1>Teleport</h1>
        <a href="#settings" data-icon="gear" class="ui-btn-right">Settings</a>
        <div data-role="navbar">
                <ul>
                    <li><a href="#home" data-icon="home">Home</a></li>
                    <li><a href="#contacts" data-icon="grid">Contacts</a></li>
                    <li><a href="#recents" data-icon="bars" class="ui-btn-active ui-state-persist">Recents</a></li>
                    <li><a href="#teleportme" data-icon="arrow-r">Teleport Me</a></li>
                </ul>
        </div><!-- /navbar -->
    
    </div><!-- /header -->
    <div data-role="content">      
      
            <ul data-role="listview" data-inset="true" data-theme="d">               
                <li data-icon="forward"><a href="#">
                    <p><strong>Alex Pagan</strong></p>
                    <span class="ui-li-count">April 17, 2013 06:09 PM</span>             
                </a></li>
                <li data-icon="back"><a href="#">
                    <p><strong>Ekaterina Ob'yedkova</strong></p>
                    <span class="ui-li-count">April 17, 2013 11:45 AM</span>
                </a></li>
                <li data-icon="forward"><a href="#">
                    <p><strong>Raj Aryan</strong></p>
                    <span class="ui-li-count">April 15, 2013 06:57 PM</span>
                </a></li>
                <li data-icon="alert"><a href="#">
                    <p><strong>Sarah Lehmann</strong></p>
                    <span class="ui-li-count">April 14, 2013 11:29 AM</span>
                </a></li>
            </ul>
        
    </div>
    
</div><!-- /home -->


<div data-role="page" id="teleportme" class="teleport">
    <div data-role="header">
        <h1>Teleport</h1>
        <a href="#settings" data-icon="gear" class="ui-btn-right">Settings</a>
        <div data-role="navbar">
                <ul>
                    <li><a href="#home" data-icon="home">Home</a></li>
                    <li><a href="#contacts" data-icon="grid">Contacts</a></li>
                    <li><a href="#recents" data-icon="bars">Recents</a></li>
                    <li><a href="#teleportme" data-icon="arrow-r" class="ui-btn-active ui-state-persist">Teleport Me</a></li>
                </ul>
        </div><!-- /navbar -->
    
    </div><!-- /header -->
    <div data-role="content" style="position:relative;">
    
       
            <input type="search" name="earth-search-input" id="earth-search-input" placeholder="MIT" value=""/>
      
       
        <div id="map-container"> 
            <div id='map3d'></div>
        </div>
       
    </div>
    
</div><!-- /home -->


<div data-role="page" id="chat" class="teleport">
        <div data-role="header">
            <h1>Teleport</h1>
            <a href="#" data-rel="back">Back</a>
            <div data-role="navbar">
                    <ul>
                        <li><a href="#home" data-icon="home">Home</a></li>
                        <li><a href="#contacts" data-icon="grid">Contacts</a></li>
                        <li><a href="#recents" data-icon="bars">Recents</a></li>
                        <li><a href="#teleportme" data-icon="arrow-r">Teleport Me</a></li>
                    </ul>
            </div><!-- /navbar -->        
        </div><!-- /header -->
        <div data-role="content">
        <div id="chat-windows">
            <div id="my-chat-window">
            </div>
        </div>
        </div>

</div><!-- /home -->








</body>
</html>
