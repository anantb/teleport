<!-- 
@author: Anant Bhardwaj

Teleport Web Page
-->

<!DOCTYPE HTML>
<html>
<head>
  <title>Teleport</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link rel=stylesheet href='/tp_static/css/style.css' type='text/css' />
  <link href='http://fonts.googleapis.com/css?family=Tangerine' rel='stylesheet' type='text/css'>
  <link rel=stylesheet href='/tp_static/css/firstpersoncam.css' type='text/css' />
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script src="http://static.opentok.com/webrtc/v2.0/js/TB.min.js" ></script>

  
</head>

<body>
<script type="text/javascript">

// Initialize API key, session, and token...
// Think of a session as a room, and a token as the key to get in to the room
// Sessions and tokens are generated on your server and passed down to the client

var apiKey = "25730622";
var sessionId = "1_MX4yNTczMDYyMn4xMjcuMC4wLjF-TW9uIEFwciAyMiAxMDo0MzowNyBQRFQgMjAxM34wLjkxNzIzM34";
var token = "T1==cGFydG5lcl9pZD0yNTczMDYyMiZzZGtfdmVyc2lvbj10YnJ1YnktdGJyYi12MC45MS4yMDExLTAyLTE3JnNpZz1hOWIxOTVkMTE5MDg3YzkyYWMwMDQxMWI4ZTM0MDg0ZThmNmQ2ZWRmOnJvbGU9cHVibGlzaGVyJnNlc3Npb25faWQ9MV9NWDR5TlRjek1EWXlNbjR4TWpjdU1DNHdMakYtVFc5dUlFRndjaUF5TWlBeE1EbzBNem93TnlCUVJGUWdNakF4TTM0d0xqa3hOekl6TTM0JmNyZWF0ZV90aW1lPTEzNjY2NTI1OTkmbm9uY2U9MC44OTYwNTQ5ODA1NDA4NDMmZXhwaXJlX3RpbWU9MTM2OTI0NDU5NyZjb25uZWN0aW9uX2RhdGE9";

// Enable console logs for debugging
TB.setLogLevel(TB.DEBUG);

// Initialize session, set up event listeners, and connect
var session = TB.initSession(sessionId);
session.addEventListener('sessionConnected', sessionConnectedHandler);
session.addEventListener('streamCreated', streamCreatedHandler);
session.connect(apiKey, token);
function sessionConnectedHandler(event) {
    var publisher = TB.initPublisher(apiKey, 'my-chat-window');
    session.publish(publisher);

    // Subscribe to streams that were in the session when we connected
    subscribeToStreams(event.streams);
}

function streamCreatedHandler(event) {
    // Subscribe to any new streams that are created
    subscribeToStreams(event.streams);
}

function subscribeToStreams(streams) {
    for (var i = 0; i < streams.length; i++) {
    // Make sure we don't subscribe to ourself
        if (streams[i].connection.connectionId == session.connection.connectionId) {
          return;
        }

        // Create the div to put the subscriber element in to
        var div = $('<div></div>');
        div.appendTo($('#chat-windows'))
        div.attr('id', 'stream' + streams[i].streamId);
        //document.body.appendChild(div);
        // Subscribe to the stream
        session.subscribe(streams[i], div.attr('id'));
    }
}

</script>

<div id="header">
    
    <span id="headlink-left">
    {% block headlink-left %}<a id="logo" href="/">Teleport</a>{% endblock %}
    </span>
    <span id="headlink-right">
    <a href="/logout">Log out</a>
    </span>
    
</div>


<div id="page">

<div id="content">
<table id="content-layout">
  <tr>
    <td class="col-small user-profile">      
      <span class="profile-big"></span>    
    </td>
    <td class="col-big">
      <div class="search-container">
      <input type="text" id="search_contacts" class="search-box" title="Search Contacts"></input>
      </div>
    </td>
  </tr>

  <tr>
<td class="col-small">

<div class="links">
<a class="nav" href="/contacts">Contacts</a>
<a class="nav" href="/feed">Feed</a>
<a class="nav active" href="/teleport">Teleport</a>
</div>
</td>
<td class="col-big">
<div id='my-chat-window'></div>
<div id="chat-windows"></div>

 

</td>
</tr>
</table>

</div>
</div>
</body>
</html>
